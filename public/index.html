<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Tangram</title>
    <!-- icon -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css"
      type="text/css"
      media="screen"
      charset="utf-8"
    />
    <!-- alert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="sweetalert2.all.min.js"></script>
    <!-- styles -->
    <link
      rel="stylesheet"
      href="css/style.css"
      type="text/css"
      media="screen"
      charset="utf-8"
    />
    <!-- js -->
    <script src="js/instructions.js"></script>
  </head>

  <body>
    <!-- <div class="title">
      <h1 class="text-center">Tangrams</h1>
    </div> -->

    <div class="left">
      <button class="button submit" onclick="showTutorial()">
        Instructions
      </button>

      <!-- <div id="firebaseui-auth-container"></div> -->

      <div class="image">
        <object id="tangramObj" data="" type="image/svg+xml"></object>
      </div>
    </div>

    <div class="right">
      <div class="output-outer">
        <p>Annotation:</p>
        <div class="output" id="output">
          <ol id="list"></ol>
        </div>
      </div>
      <button id="next" class="button next" disabled>Next</button>
      <div class="annotation">
        <input
          id="annotate"
          class="textbox"
          type="text"
          onkeyup="stoppedTyping()"
          disabled
        />
        <button id="submit" class="button submit" disabled>Submit</button>
      </div>
    </div>

    <script>
      function stoppedTyping() {
        var text = document.getElementById("annotate");
        var bt = document.getElementById("submit");
        if (text.value.length === 0 || selection.every((v) => v === false)) {
          // empty input or no selection
          bt.disabled = true;
          bt.setAttribute("class", "button submit");
          bt.innerText = "Submit";
        } else {
          bt.disabled = false;
          //duplicate
          if (ann_to_idx[text.value]) {
            bt.setAttribute("class", "button add");
            bt.innerText = "Add to Group";
          } else {
            //new annotation
            bt.setAttribute("class", "button submit");
            bt.innerText = "Submit";
          }
        }
      }

      // remove annotation
      function remove(ann, id) {
        var list = document.getElementById("list");
        var item = document.getElementById(id);
        list.removeChild(item);
        //lookup id(annotation) to pieces
        const pieces = ann_to_idx[ann];
        for (var i = 0; i < pieces.length; i++) {
          //remove piece annotation
          const piece_id = pieces[i];
          annotated[piece_id] = "";
          var a = document.getElementById("tangramObj");
          var svgDoc = a.contentDocument;
          var t = svgDoc.getElementById(piece_id);
          t.setAttribute("fill", "lightgray");
          // reset tracker data
          piece_to_color[piece_id] = "";
        }
        //delete ann_to_idx entry
        delete ann_to_idx[ann];
        // set final to false in log
        metadata[id]["final"] = false;

        // disable next
        var next = document.getElementById("next");
        next.disabled = true;

        logging();
      }
    </script>

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.4.3/firebase-app.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.4.3/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.3/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.3/firebase-storage.js"></script>

    <script type="text/javascript" src="js/firebaseConfig.js"></script>

    <script src="https://www.gstatic.com/firebasejs/ui/4.8.0/firebase-ui-auth.js"></script>
    <link
      type="text/css"
      rel="stylesheet"
      href="https://www.gstatic.com/firebasejs/ui/4.8.0/firebase-ui-auth.css"
    />

    <!-- <script type="text/javascript">
      var ui = new firebaseui.auth.AuthUI(firebase.auth());
      var uiConfig = {
        callbacks: {
          signInSuccessWithAuthResult: function (authResult, redirectUrl) {
            // User successfully signed in.
            // Return type determines whether we continue the redirect automatically
            // or whether we leave that to developer to handle.
            console.log(authResult, redirectUrl);
            return false;
          },
          uiShown: function () {
            // The widget is rendered.
            // Hide the loader.
            document.getElementById("loader").style.display = "none";
          },
        },
        // Will use popup for IDP Providers sign-in flow instead of the default, redirect.
        signInFlow: "popup",
        signInSuccessUrl: "<url-to-redirect-to-on-success>",
        signInOptions: [firebase.auth.EmailAuthProvider.PROVIDER_ID],
        // Other config options...
      };
      ui.start("#firebaseui-auth-container", uiConfig);
    </script> -->
    <script type="text/javascript" src="js/mainTrial.js"></script>
    <script type="text/javascript" src="js/pieceTrial.js"></script>
  </body>
</html>
